<!DOCTYPE html>
<html>
<head>
  <title>FishCart Admin Panel</title>
  <style>
    body { font-family: Arial; background: #f2f2f2; padding: 20px; }
    h2 { text-align: center; }
    .hidden { display: none; }
    .section { margin: 20px 0; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 8px; }
    input[type='number'] { width: 80px; }
    button { cursor: pointer; margin: 5px; }
    .card { border: 1px solid #ccc; padding: 10px; margin: 10px; background: #fff; }
    .container { display: flex; flex-wrap: wrap; }
    .card input[type='number'] { width: 60px; margin-left: 10px; }
    .price-tag { color: green; font-size: 14px; margin-left: 10px; }
  </style>
</head>
<body>

<div id="login">
  <h2>FishCart Login</h2>
  Username: <input type="text" id="username"><br><br>
  Password: <input type="password" id="password"><br><br>
  <button onclick="login()">Login</button>
</div>

<!-- Admin Panel -->
<div id="admin-panel" class="hidden">
  <h2>FishCart Admin Panel</h2>
  <button onclick="logout()">Logout</button>

  <div class="section">
    <h3>Stock Update</h3>
    <table>
      <tr>
        <th>Fish</th><th>Current Stock (kg)</th><th>Pending (kg)</th><th>Delivered (kg)</th>
      </tr>
      <tr><td>Surmai</td><td><input type="number" id="stock-surmai" value="10"></td><td id="pending-surmai">0</td><td id="delivered-surmai">0</td></tr>
      <tr><td>Kolambi</td><td><input type="number" id="stock-kolambi" value="10"></td><td id="pending-kolambi">0</td><td id="delivered-kolambi">0</td></tr>
      <tr><td>Bangda</td><td><input type="number" id="stock-bangda" value="10"></td><td id="pending-bangda">0</td><td id="delivered-bangda">0</td></tr>
      <tr><td>Bombil</td><td><input type="number" id="stock-bombil" value="10"></td><td id="pending-bombil">0</td><td id="delivered-bombil">0</td></tr>
    </table>
  </div>

  <div class="section">
    <h3>Pending Orders</h3>
    <table id="pending-orders">
      <tr><th>Order</th><th>Action</th></tr>
    </table>
  </div>

  <div class="section">
    <h3>Delivered Orders</h3>
    <table id="delivered-orders">
      <tr><th>Order</th><th>Cash Received (₹)</th></tr>
    </table>
    <p><strong>Total Cash Received: ₹<span id="total-cash">0</span></strong></p>
  </div>
</div>

<!-- Staff Panel -->
<div id="staff-panel" class="hidden">
  <h2>Staff Panel</h2>
  <button onclick="logout()">Logout</button>

  <div class="container" id="fishForm">
    <div class="card">
      <h3>Surmai <span class="price-tag">₹800/kg</span></h3>
      <input type="checkbox" id="surmai" data-price="800">
      <input type="number" min="1" id="qty-surmai">
      <select id="unit-surmai"><option value="kg">kg</option><option value="g">g</option></select>
    </div>

    <div class="card">
      <h3>Kolambi <span class="price-tag">₹650/kg</span></h3>
      <input type="checkbox" id="kolambi" data-price="650">
      <input type="number" min="1" id="qty-kolambi">
      <select id="unit-kolambi"><option value="kg">kg</option><option value="g">g</option></select>
    </div>

    <div class="card">
      <h3>Bombil <span class="price-tag">₹200/kg</span></h3>
      <input type="checkbox" id="bombil" data-price="200">
      <input type="number" min="1" id="qty-bombil">
      <select id="unit-bombil"><option value="kg">kg</option><option value="g">g</option></select>
    </div>

    <div class="card">
      <h3>Bangda <span class="price-tag">₹300/kg</span></h3>
      <input type="checkbox" id="bangda" data-price="300">
      <input type="number" min="1" id="qty-bangda">
      <select id="unit-bangda"><option value="kg">kg</option><option value="g">g</option></select>
    </div>
  </div>
  <button onclick="submitStaffOrder()">Submit Order</button>
</div>

<script>
  const validUser = "Fishcart";
  const validPass = "admin";
  const staffUser = "staff";
  const staffPass = "1234";

  const fishPrices = { surmai: 800, kolambi: 650, bombil: 200, bangda: 300 };
  const pendingQty = { surmai: 0, kolambi: 0, bangda: 0, bombil: 0 };
  const deliveredQty = { surmai: 0, kolambi: 0, bangda: 0, bombil: 0 };
  let totalCash = 0;

  function login() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    if (user === validUser && pass === validPass) {
      document.getElementById("login").classList.add("hidden");
      document.getElementById("admin-panel").classList.remove("hidden");
    } else if (user === staffUser && pass === staffPass) {
      document.getElementById("login").classList.add("hidden");
      document.getElementById("staff-panel").classList.remove("hidden");
    } else {
      alert("Invalid login!");
    }
  }

  function logout() {
    document.getElementById("admin-panel").classList.add("hidden");
    document.getElementById("staff-panel").classList.add("hidden");
    document.getElementById("login").classList.remove("hidden");
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";
    alert("Logout successful!");
  }

  function submitStaffOrder() {
    const fishes = ["surmai", "kolambi", "bombil", "bangda"];
    let order = [];
    fishes.forEach(fish => {
      if (document.getElementById(fish).checked) {
        let qty = parseFloat(document.getElementById(`qty-${fish}`).value);
        let unit = document.getElementById(`unit-${fish}`).value;
        if (qty > 0) {
          order.push(`${qty}${unit} ${capitalize(fish)}`);
        }
      }
    });

    if (order.length === 0) {
      alert("Please select at least one fish.");
      return;
    }

    const orderStr = order.join(", ");
    addPendingOrder(orderStr);
    alert("Order submitted to admin panel!");
    document.querySelectorAll('#fishForm input[type="checkbox"]').forEach(cb => cb.checked = false);
    document.querySelectorAll('#fishForm input[type="number"]').forEach(input => input.value = '');
  }

  function addPendingOrder(order) {
    const table = document.getElementById("pending-orders");
    const row = table.insertRow();
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const total = calculatePrice(order);
    cell1.innerText = `${order} — ₹${total}`;
    const btn = document.createElement("button");
    btn.innerText = "Mark as Delivered";
    btn.onclick = function () {
      moveToDelivered(order);
      table.deleteRow(row.rowIndex);
      updateStock(order);
    };
    cell2.appendChild(btn);
    updatePendingQuantity(order);
  }

  function moveToDelivered(order) {
    const table = document.getElementById("delivered-orders");
    const row = table.insertRow();
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const total = calculatePrice(order);
    cell1.innerText = order;
    cell2.innerText = `₹${total}`;
    totalCash += parseFloat(total);
    document.getElementById("total-cash").innerText = totalCash.toFixed(0);
    updateDeliveredQuantity(order);

    // WhatsApp message
    const msg = `Delivery Confirmed:\n${order}\nTotal: ₹${total}`;
    const whatsappURL = `https://wa.me/919967404633?text=${encodeURIComponent(msg)}`;
    window.open(whatsappURL, '_blank');
  }

  function calculatePrice(order) {
    let total = 0;
    const items = order.split(",");
    items.forEach(item => {
      const parts = item.trim().toLowerCase();
      const match = parts.match(/([\d.]+)\s*(kg|g)\s*(.*)/);
      if (match) {
        let [_, amount, unit, name] = match;
        let qty = parseFloat(amount);
        if (unit === "g") qty = qty / 1000;
        let fish = name.trim().replace(/\s/g, '').toLowerCase();
        const pricePerKg = fishPrices[fish] || 0;
        total += qty * pricePerKg;
      }
    });
    return total.toFixed(0);
  }

  function updateStock(order) {
    const items = order.split(",");
    items.forEach(item => {
      const match = item.trim().toLowerCase().match(/([\d.]+)\s*(kg|g)\s*(.*)/);
      if (match) {
        let [_, amount, unit, name] = match;
        let qty = parseFloat(amount);
        if (unit === "g") qty /= 1000;
        const fish = name.trim().replace(/\s/g, '').toLowerCase();
        const stockInput = document.getElementById(`stock-${fish}`);
        if (stockInput) {
          let current = parseFloat(stockInput.value) || 0;
          current -= qty;
          if (current < 0) current = 0;
          stockInput.value = current.toFixed(2);
          pendingQty[fish] -= qty;
          if (pendingQty[fish] < 0) pendingQty[fish] = 0;
          document.getElementById(`pending-${fish}`).innerText = pendingQty[fish].toFixed(2);
        }
      }
    });
  }

  function updatePendingQuantity(order) {
    const items = order.split(",");
    items.forEach(item => {
      const match = item.trim().toLowerCase().match(/([\d.]+)\s*(kg|g)\s*(.*)/);
      if (match) {
        let [_, amount, unit, name] = match;
        let qty = parseFloat(amount);
        if (unit === "g") qty /= 1000;
        const fish = name.trim().replace(/\s/g, '').toLowerCase();
        pendingQty[fish] += qty;
        document.getElementById(`pending-${fish}`).innerText = pendingQty[fish].toFixed(2);
      }
    });
  }

  function updateDeliveredQuantity(order) {
    const items = order.split(",");
    items.forEach(item => {
      const match = item.trim().toLowerCase().match(/([\d.]+)\s*(kg|g)\s*(.*)/);
      if (match) {
        let [_, amount, unit, name] = match;
        let qty = parseFloat(amount);
        if (unit === "g") qty /= 1000;
        const fish = name.trim().replace(/\s/g, '').toLowerCase();
        deliveredQty[fish] += qty;
        document.getElementById(`delivered-${fish}`).innerText = deliveredQty[fish].toFixed(2);
      }
    });
  }

  function capitalize(word) {
    return word.charAt(0).toUpperCase() + word.slice(1);
  }
</script>

</body>
</html>
